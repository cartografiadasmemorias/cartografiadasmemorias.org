<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>CARTOGRAFIA DAS MEMÓRIAS</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="style.css" rel="stylesheet" />
  <!-- Google fonts-->
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
  <link rel="shortcut icon" href="media/favicon.ico" />
  
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
  
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- import the webpage's javascript file -->
    <script src="/script.js" defer></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://npmcdn.com/csv2geojson@latest/csv2geojson.js"></script>
  <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
  <style>
 </style>
</head>

<body>
  
<div id="map"></div>
  
<!-- Sidebar -->
<div class="sidebar bar-block collapse card animate-left" style="width: 100% !important; max-width: 500px !important; display: none;" id="mySidebar">
  <button class="transparent-button bar-item my-button large hide-large my-hide-button" style="display: inline-block !important" onclick="w3_close()">&times;</button> <div style="display: inline-block; font-size:10px; 
  position: absolute !important; right: 0; padding-right:34px;">PT | </div><a style= "display: inline-block; font-size:10px; 
  position: absolute !important; right: 0; padding-right:15px;" href="http://cartografiadasmemorias.xyz/en">EN</a>
   <br><br>
   <img style="display: inline-block; width:10%; vertical-align:top !important" src="media/orelha_azul.png">
   <a style="display: inline-block" href="https://bit.ly/3eT5VTn" target="_blank"> Envie um áudio com seu relato<br>21 99658-5407</a><br><br>
      <li>Os áudios devem ter no máximo 5 minutos</li>
      <li>Informe sua localização aproximada</li> 
      <li>Não é necessário se identificar</li>
      <br>
      <hr>
      <br>O projeto "Cartografia das memórias" tem como objetivo registrar e preservar, através de relatos orais, as memórias de vivências individuais e coletivas durante a pandemia. Você pode colaborar com o envio de seu relato e também com o compartilhamento desta iniciativa com suas redes!
      <br> 
      <p>
        Somos um grupo formado por historiadores, cientistas, artistas, comunicadores, desenvolvedores, educadores e divulgadores. Nos reunimos através do 
        <a style="vertical-align:baseline", href="https://labdeemergencia.silo.org.br/"  target="_blank" > Laboratório de Emergência | Covid–19</a>, para trabalharmos juntos em alternativas solidárias neste contexto.
       <br><br><br>
       <a target="_blank" href="mailto:cartografiadasmemorias@gmail.com ">cartografiadasmemorias@gmail.com </a>
       <br>
       <a href="https://www.instagram.com/cartografiadasmemorias" target="_blank" class="fa fa-instagram"></a>
       <a href="https://www.facebook.com/cartografiadasmemorias/" target="_blank" class="fa fa-facebook"></a>
       <a href="https://soundcloud.com/cartografia-das-memorias" target="_blank" class="fa fa-soundcloud"></a>
    </p>
</div>
  
  
  
<div class="main" style="margin-left:0px">
    <div class="teal">
      <div class="menu-fixo">
          <button class="transparent-button my-button teal xlarge hide-large" onclick="w3_open()">&#9776;</button>
          <button class="transparent-button my-button teal xlarge hide-large logo-nav" onclick="w3_open()"><img src="media/logo.png" align="left" width="100%"></button>
      </div>
    </div>
  
  <div>
	    <a class="recorder-button" href="#recorderpopup1"><img src="media/rec.png" width="100%"></a>
  </div>

<div id="recorderpopup1" class="recorderoverlay">
	<div class="recorderpopup">
		<br><h2>ENVIE SEU RELATO</h2>
     
		<a class="recorderclose" href="#">&times;</a>
		<div class="recordercontent">
			Clique abaixo para gravar um áudio de até 5 minutos.<br><br>
       <div id="controls">
         <button class="transparent-button"  id="recordButton"><img src="media/rec.png"  class="center"></button>
         <button class="transparent-button" id="stopButton" hidden><img src="media/rec_gif.gif"  class="center"></button>
      </div>
		</div>
    <ul style="list-style: none;" id="recordingsList"></ul>
    <!-- inserting these scripts at the end to be able to use all the elements in the DOM -->
  	<script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
    <script src="app.js"></script>
    <!-- The Modal -->
    <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <i class="close" onclick="fechar()">&times;</i>
        <label>Bairro:</label>
        <div class="modal-input">
          <input id="bairro" type="text"></input>
        </div>
        <label>Cidade:</label>
        <div class="modal-input">
          <input id="cidade" type="text"></input>
        </div>
        <button id="enviar" onclick="enviar()">enviar</button>
      </div>

    </div>
	</div>
  
</div>
  
  
  <script>

    var transformRequest = (url, resourceType) => {
      var isMapboxRequest =
        url.slice(8, 22) === "api.mapbox.com" ||
        url.slice(10, 26) === "tiles.mapbox.com";
      return {
        url: isMapboxRequest
          ? url.replace("?", "?pluginName=sheetMapper&")
          : url
      };
    };
    //YOUR TURN: add your Mapbox token 
    mapboxgl.accessToken = 'pk.eyJ1IjoiY2FydG9ncmFmaWFkYXNtZW1vcmlhcyIsImEiOiJjazlxMDN1aG0wZnY4M2xvZHJjajdldnE3In0.qHPWWLN-r8EmzjGLm3afAA'; //Mapbox token 
    var map = new mapboxgl.Map({
      container: 'map', // container id
      style: 'mapbox://styles/cartografiadasmemorias/ckaoohfqc2lt61iom1u8d9ec3', //stylesheet location
      center: [5.632976, 25.693782], // starting position
      zoom: 0.9,// starting zoom
      transformRequest: transformRequest
    });

    $(document).ready(function () {
      $.ajax({
        type: "GET",
        //YOUR TURN: Replace with csv export link
        url: 'https://docs.google.com/spreadsheets/d/13xv9K7am3ptr-Z9a734OrWoIcyWsZkX3tvUhX4lBOUQ/gviz/tq?tqx=out:csv&sheet=Sheet3',
        dataType: "text",
        success: function (csvData) { makeGeoJSON(csvData); }
      });



      function makeGeoJSON(csvData) {
        csv2geojson.csv2geojson(csvData, {
          latfield: 'Latitude',
          lonfield: 'Longitude',
          delimiter: ','
        }, function (err, data) {
          
          map.on('load', function () {
            

            //Add the the layer to the map 
            map.addLayer({
              'id': 'csvData',
              'type': 'circle',
              'source': {
                'type': 'geojson',
                'data': data
              },
              'paint': {
/*
                'circle-radius': [
                'interpolate',
                ['exponential', 0.5],
                ['zoom'],
                0,
                1,
                22,
                10],*/

                'circle-color': "#981e3a"
              }
              
            });
            
            map.addLayer({
              'id': 'csvData2',
              'type': 'symbol',
              'layout': {
                 'icon-image': 'rocket-15'
               }
             });

            // When a click event occurs on a feature in the csvData layer, open a popup at the
            // location of the feature, with description HTML from its properties.
            map.on('click', 'csvData', function (e) {
              var coordinates = e.features[0].geometry.coordinates.slice();

              //set popup text 
              //You can adjust the values of the popup to match the headers of your CSV. 
              // For example: e.features[0].properties.Name is retrieving information from the field Name in the original CSV. 
              /* player mixcloud
              var description = `<iframe width="100%" height="60" src="` + e.features[0].properties.Audio + `" frameborder="0" allow="autoplay"></iframe>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + `TAGS ` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              */
              
              /*
              player archive.org 
              var description = `<iframe src="` + e.features[0].properties.Audio + `" width="100%" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + `TAGS ` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              */
              
               /*
              player html*/
              var description = `<audio controls style="width:100%;" controlsList="nodownload" autoplay><source src="` + e.features[0].properties.Audio + `" type="audio/mpeg"></audio>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + `TAGS ` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              
              
              
              // Ensure that if the map is zoomed out such that multiple
              // copies of the feature are visible, the popup appears
              // over the copy being pointed to.
              while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
              }

              //add Popup to map

              new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(description)
                .addTo(map);
            });

            // Change the cursor to a pointer when the mouse is over the places layer.
            map.on('mouseenter', 'csvData', function () {
              map.getCanvas().style.cursor = 'pointer';
            });

            // Change it back to a pointer when it leaves.
            map.on('mouseleave', 'places', function () {
              map.getCanvas().style.cursor = '';
            });

            var bbox = turf.bbox(data);
            map.fitBounds(bbox, { padding: 50 });
 
            
            map.setPaintProperty('csvData', 'circle-radius', 
            ['interpolate', ['linear'], ['zoom'],
              5,
              5,
              20,
              25,
              24,
              30
            ]);
            
            
          });

        });
      };
      
      
    });
    
    
      map.addControl(new mapboxgl.NavigationControl());
    
      document.getElementById('zoom').addEventListener('click', function() {
        map.zoomTo(19, { duration: 9000 });
      });

  </script>

  
<script>
function w3_open() {
  document.getElementById("mySidebar").style.display = "block";
}

function w3_close() {
  document.getElementById("mySidebar").style.display = "none";
}
</script>
     
  
  
</body>

</html>