<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>CARTOGRAFIA DAS MEMÓRIAS</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="style.css" rel="stylesheet" />
  <!-- Google fonts-->
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
  <link rel="shortcut icon" href="https://cdn.glitch.com/cc7faef1-b3a9-4ac2-8860-d76173b54f51%2Ffavicon.ico?v=1590618126108" />
  
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
  
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- import the webpage's javascript file -->
    <script src="/script.js" defer></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://npmcdn.com/csv2geojson@latest/csv2geojson.js"></script>
  <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.css" type="text/css" />
  
</head>

<body>
  
<div id="map"></div>
  
<!-- Sidebar -->
<div class="sidebar bar-block collapse card animate-left" style="width: 100% !important; max-width: 500px !important; display: none;" id="mySidebar">
  <button class="transparent-button bar-item my-button large hide-large my-hide-button" style="display: inline-block !important" onclick="w3_close()">&times;</button> <div style="display: inline-block; font-size:10px; 
  position: absolute !important; right: 0; padding-right:34px;">PT | </div><a style= "display: inline-block; font-size:10px; 
  position: absolute !important; right: 0; padding-right:15px;" href="http://cartografiadasmemorias.xyz/en">EN</a>
   <br><br>
   <img style="display: inline-block; width:10%; vertical-align:top !important" src="https://cdn.glitch.com/cc7faef1-b3a9-4ac2-8860-d76173b54f51%2FLOGO_CORES-08.png?v=1590619201597">
   <a style="display: inline-block" href="https://bit.ly/3eT5VTn" target="_blank"> Envie um áudio com seu relato<br>21 99658-5407</a><br><br>
      <li>Os áudios devem ter no máximo 5 minutos</li>
      <li>Informe sua localização aproximada</li> 
      <li>Não é necessário se identificar</li>
      <br>
      <hr>
      <br>O projeto "Cartografia das memórias" tem como objetivo registrar e preservar, através de relatos orais, as memórias de vivências individuais e coletivas durante a pandemia. Você pode colaborar com o envio de seu relato e também com o compartilhamento desta iniciativa com suas redes!
      <br><br>
      <p>
        Somos um grupo formado por historiadores, cientistas, artistas, comunicadores, desenvolvedores, educadores e divulgadores. Nos reunimos através do 
        <a style="vertical-align:baseline" href="https://labdeemergencia.silo.org.br/"  target="_blank" > Laboratório de Emergência | Covid–19</a>, para trabalharmos juntos em alternativas solidárias neste contexto.
       <br><br><br>
       <a target="_blank" href="mailto:cartografiadasmemorias@gmail.com ">cartografiadasmemorias@gmail.com </a>
       <br>
       <a href="https://www.instagram.com/cartografiadasmemorias" target="_blank" class="fa fa-instagram"></a>
       <a href="https://www.facebook.com/cartografiadasmemorias/" target="_blank" class="fa fa-facebook"></a>
       <a href="https://soundcloud.com/cartografia-das-memorias" target="_blank" class="fa fa-soundcloud"></a>
    </p>
</div>
  
<div class="sidenav">
    
      <div class="menu-fixo">
          <button class="transparent-button my-button teal xlarge hide-large" onclick="w3_open()"><img src= "https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2Fhamburguer_rosa.png?v=1591532711640" width="100%"></button>   
      </div>
    
      <a class="recorder-button" data="Grave seu relato" href="#recorderpopup1"><img src="https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2Frecorder_rosa.png?v=1591532711763" width="100%"></a>    

     <div class="logo">
          <img src="https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2Flogo_cor.png?v=1591532712363" width="80%">
     </div>

</div>

 
<div id="recorderpopup1" class="recorderoverlay">
	<div class="recorderpopup">
		<br><h2>ENVIE SEU RELATO</h2>
     
		<a class="recorderclose" href="#">&times;</a>
		<div class="recordercontent">
			Clique abaixo para gravar um áudio de até 5 minutos.<br><br>
       <div id="controls">
         <button class="transparent-button"  id="recordButton"><img src="https://cdn.glitch.com/cc7faef1-b3a9-4ac2-8860-d76173b54f51%2FLOGO_CORES-25.png?v=1590664189371"  class="center"></button>
         <button class="transparent-button" id="stopButton" hidden><img src="https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2Fstop.gif?v=1590962448755"  class="center"></button>
      </div>
		</div>
    <ul style="list-style: none;" id="recordingsList"></ul>
    <!-- inserting these scripts at the end to be able to use all the elements in the DOM -->
  	<script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
    <script src="app.js"></script>
    <!-- The Modal -->
    <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <i class="close" onclick="fechar()">&times;</i>
        <label>Bairro:</label>
        <div class="modal-input">
          <input id="bairro" type="text"><input>
        </div>
        <label>Cidade:</label>
        <div class="modal-input">
          <input id="cidade" type="text"><input>
        </div>
        <button id="enviar" onclick="enviar()">enviar</button>
      </div>

    </div>
	</div>
  
</div>
  
  

  
  <script>
    var geocoder = new MapboxGeocoder({
       accessToken: mapboxgl.accessToken,
       mapboxgl: mapboxgl
    });
    
    var transformRequest = (url, resourceType) => {
      var isMapboxRequest =
        url.slice(8, 22) === "api.mapbox.com" ||
        url.slice(10, 26) === "tiles.mapbox.com";
      return {
        url: isMapboxRequest
          ? url.replace("?", "?pluginName=sheetMapper&")
          : url
      };
    };
    //YOUR TURN: add your Mapbox token 
    mapboxgl.accessToken = 'pk.eyJ1IjoiY2FydG9ncmFmaWFkYXNtZW1vcmlhcyIsImEiOiJjazlxMDN1aG0wZnY4M2xvZHJjajdldnE3In0.qHPWWLN-r8EmzjGLm3afAA'; //Mapbox token 
    var map = new mapboxgl.Map({
      container: 'map', // container id
      style: 'mapbox://styles/cartografiadasmemorias/ckaoohfqc2lt61iom1u8d9ec3', //stylesheet location
      center: [5.632976, 25.693782], // starting position
      zoom: 0.9,// starting zoom
      transformRequest: transformRequest
    });

    $(document).ready(function () {
      $.ajax({
        type: "GET",
        //YOUR TURN: Replace with csv export link
        url: 'https://docs.google.com/spreadsheets/d/13xv9K7am3ptr-Z9a734OrWoIcyWsZkX3tvUhX4lBOUQ/gviz/tq?tqx=out:csv&sheet=Sheet3',
        dataType: "text",
        success: function (csvData) { makeGeoJSON(csvData); }
      });



      function makeGeoJSON(csvData) {
        csv2geojson.csv2geojson(csvData, {
          latfield: 'Latitude',
          lonfield: 'Longitude',
          delimiter: ','
        }, function (err, data) {
          
          map.on('load', function () {
            
            map.loadImage(
              //'https://cdn.glitch.com/cc7faef1-b3a9-4ac2-8860-d76173b54f51%2FLOGO_CORES-16.png?v=1590662908119',
              //'https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2Fpunaise2.png?v=1591167898900' ,
              //'https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2Fpunaise3.png?v=1591168517277',
              //'https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2FCo%CC%81pia%20de%20gota%2Borelha.png?v=1591169258037',
              //'https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2FPrancheta%201.png?v=1591171074397',
              //'https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2FgotaRVB-17333.png?v=1591237058710',
              'https://cdn.glitch.com/a322fddf-e1a0-4b92-b1ef-c82afcaad9ba%2Falfinete-8k.png?v=1591319153566',
              function(error, image) {
              if (error) throw error;
              map.addImage('ear', image);
            });

            //Add the the layer to the map 
           /* map.addLayer({
              'id': 'csvData',
              'type': 'circle',
              'source': {
                'type': 'geojson',
                'data': data
              },
              'paint': {
                'circle-color': "#981e3a"
              }
              
            }); */

            map.addLayer({
              'id': 'csvData',
              'type': 'symbol',
              'source': {
                'type': 'geojson',
                'data': data
              },
              'layout': {
                'icon-image': 'ear',
                'icon-anchor': 'bottom', // point of the icon which will correspond to marker's location
                "icon-allow-overlap": true,
                //'icon-size': 0.025
              }
             });


            // When a click event occurs on a feature in the csvData layer, open a popup at the
            // location of the feature, with description HTML from its properties.
            map.on('click', 'csvData', function (e) {
              var coordinates = e.features[0].geometry.coordinates.slice();

              //set popup text 
              //You can adjust the values of the popup to match the headers of your CSV. 
              // For example: e.features[0].properties.Name is retrieving information from the field Name in the original CSV. 
              /* player mixcloud
              var description = `<iframe width="100%" height="60" src="` + e.features[0].properties.Audio + `" frameborder="0" allow="autoplay"></iframe>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + ` TAGS` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              */
              
              /*
              player archive.org 
              var description = `<iframe src="` + e.features[0].properties.Audio + `" width="100%" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + `TAGS ` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              */
              
               /*
              player html*/
              var description = `<audio controls style="width:100%;" controlsList="nodownload" autoplay><source src="` + e.features[0].properties.Audio + `" type="audio/mpeg"></audio>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + ` ` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              
              
              
              // Ensure that if the map is zoomed out such that multiple
              // copies of the feature are visible, the popup appears
              // over the copy being pointed to.
              while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
              }

              //add Popup to map

              new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(description)
                .addTo(map);
            });

            // Change the cursor to a pointer when the mouse is over the places layer.
            map.on('mouseenter', 'csvData', function () {
              map.getCanvas().style.cursor = 'pointer';
            });
            
             map.on('mouseenter', 'csvData2', function () {
              map.getCanvas().style.cursor = 'pointer';
            });

            // Change it back to a pointer when it leaves.
            map.on('mouseleave', 'places', function () {
              map.getCanvas().style.cursor = '';
            });

            var bbox = turf.bbox(data);
            map.fitBounds(bbox, { padding: 50 });
 
            
            /*map.setPaintProperty('csvData', 'circle-radius', 
            ['interpolate', ['linear'], ['zoom'],
              5,
              5,
              20,
              25,
              24,
              30
            ]);*/
            
            map.setLayoutProperty('csvData', 'icon-size', 
            ['interpolate', ['linear'], ['zoom'],
              0,
              //TAMANHO AO ZOOM 0
              0.18,
              6,
              //TAMANHO AO ZOOM 7
              0.25,
              15,
              //TAMANHO AO ZOOM 20
              0.35,
              24,
              //TAMANHO AO ZOOM 24
              0.6
            ]);
        
            
          });

        });
      };
      
      
    });
    

      map.addControl(new mapboxgl.NavigationControl(), 'top-left');
      map.addControl(geocoder);
      document.getElementById('geocoder').appendChild(geocoder.onAdd(map));
      document.getElementById('zoom').addEventListener('click', function() {
        map.zoomTo(19, { duration: 9000 });
      });


        function render(feature){
            return `<span class='geocoder-menu-item'>${feature.place_name}</span>`
        }
      
    
  </script>

  
<script>
function w3_open() {
  document.getElementById("mySidebar").style.display = "block";
}

function w3_close() {
  document.getElementById("mySidebar").style.display = "none";
}
</script>

<script>
$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip();
});
</script>
  
</body>

</html>