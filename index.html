<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>CARTOGRAFIA DAS MEMÓRIAS</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="style.css" rel="stylesheet" />
  <!-- Google fonts-->
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
  <link rel="shortcut icon" href="https://cdn.glitch.com/cc7faef1-b3a9-4ac2-8860-d76173b54f51%2Ffavicon.ico?v=1590618126108" />
 <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">-->
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
  
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="style.css">
    
    <!-- import the webpage's javascript file -->
    <script src="script.js" defer></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://npmcdn.com/csv2geojson@latest/csv2geojson.js"></script>
  <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.css" type="text/css" />
  
</head>

<body>
  
<div id="map"></div>
  
<!-- Sidebar -->
<div class="sidebar bar-block collapse card animate-left" style="width: 100% !important; max-width: 550px !important; display: none;" id="mySidebar">

  <button class="transparent-button bar-item my-button large hide-large my-hide-button" style="display: inline-block !important; right: 30px!important;position: absolute !important;" onclick="w3_close()">&times;</button> 
   <br><br>
  <hr>
      <div class="row">
        <div class="column" style="text-align:left!important;">
          <a onclick="Sobre()" id="sobre-nav" style="color:#b2c9c9!important;">SOBRE</a>
        </div>
        <div class="column" style="text-align:center!important;">
         <a onclick="Termos()" id="termos-nav" >TERMOS	&nbsp;	&nbsp;</a>
        </div>
        <div class="column" style="text-align:right!important;">
          <a onclick="Contato()" id="contato-nav" >CONTATO</a>
        </div>
      </div>
  <hr>
  <br>

      <br><br>
  <div id="sobre" class="sidebarmenu" style="z-index:2;">
        <br><br>
        Este mapa sonoro é uma iniciativa colaborativa que busca registrar e preservar, através de relatos orais, memórias de vivências pessoais durante a pandemia da Covid-19, iniciada em 2020.
        Você pode colaborar com o envio de seu relato e também com o compartilhamento do projeto em suas redes.
        <br><p></p>
        Desejamos alcançar o maior número e diversidade de relatos possíveis para formar um panorama heterogêneo de pontos de vistas sobre este evento de escala mundial.
        <br><p></p>
        O projeto foi criado por um grupo formado por historiadores, cientistas, artistas, comunicadores, desenvolvedores, artistas, comunicadores, desenvolvedores, educadores e divulgadores. Estes profissionais se reuniram através do <a href="https://labdeemergencia.silo.org.br" target="_blank">Laboratório de Emergência | Covid–19</a> para trabalharem juntos em alternativas solidárias.
        <br><p></p>
        Este projeto é apoiado por uma doação da Open Society Foundations, gerenciada pelo Centro de Direitos Humanos Aplicados – Universidade de York (Reino Unido)
        [Arte + Ativismo Contra Repressão Durante a Crise de Covid-19].
        <br><br><p></p>
        <b>EQUIPE | Colaboradoras</b>
        <br><a href="" style="color:#23446c;" target="_blank">Keila Zaché</a>
        <br><a href="https://www.behance.net/btrzrs" style="color:#23446c;" target="_blank">Beatriz Viana</a>
        <br><a href="https://claricelacerda.com" style="color:#23446c;" target="_blank">Clarice G. Lacerda</a>
        <br><a href="" style="color:#23446c;" target="_blank">Hércules da Silva Xavier Ferreira</a>
        <br><a href="http://soundcloud.com/jjjulianar" style="color:#23446c;" target="_blank">Juliana R.</a>
        <br><a href="https://touca.ninja" style="color:#23446c;" target="_blank">Sara Lana</a>
        <br><a href="" style="color:#23446c;" target="_blank">Victor</a>
        <br>
        <div class="collapsible"><b>+</b></div>
          <div class="content">
            <b>Já colaboraram com o cartografias: </b>
            <br>Bernardo Baião, Caroline Trinidade, Clareana Aroxa, Julia Chacur e Wellison Silva.
          </div>
    <br><br><br>
  </div>

  
  <div id="termos" class="sidebarmenu">
        Todos os relatos em áudio presentes nesta plataforma são licenciados pela Creative Commons e podem ser usados para diversos fins não comer- ciais, desde que atribua o devido crédito.
        <br><br><br><br>   
      <div class="center-text">
        <img src="media/cc.png" width="50%">
      </div>
  </div>
  
  <div id="contato" class="sidebarmenu">
        cartografiadasmemorias@gmail.com 
       <br>
        <div class="center-text">
           <a href="https://www.instagram.com/cartografiadasmemorias" target="_blank" class="fa fa-instagram"></a>
           <a href="https://www.facebook.com/cartografiadasmemorias/" target="_blank" class="fa fa-facebook"></a>
           <a href="https://soundcloud.com/cartografia-das-memorias" target="_blank" class="fa fa-soundcloud"></a>
        </div>  
  </div>

</div>

  
<div class="sidenav">  
      <div class="menu-fixo">
          <button class="transparent-button my-button teal xlarge hide-large" onclick="w3_open()"><img src= "media/hamburguer_rosa.png" width="100%"></button>   
      </div>  
      <a class="recorder-button" data="Grave seu relato" href="#recorderpopup1"><img src="media/rec_azul.png" width="100%"></a>    
     
    <div class="logo">
          <img src="media/logo_pt_v.png" width="45%">
     </div>
  
    <div class="lang center-text" style="font-size:12px;">
      PT<br>
      <a href="http://cartografiadasmemorias.xyz/en" style="font-weight:normal;text-decoration: none;color: #23446c !important;">EN</a>
    </div>
  
</div>

<div class="sidenav-top">  
      <div class="menu-fixo">
          <button class="transparent-button my-button teal xlarge hide-large" onclick="w3_open()"><img src= "media/hamburguer_rosa.png" width="100%"></button>   
      </div>  
     
    <div class="logo_h">
          <img src="https://cdn.glitch.com/471483de-9816-4234-863a-51f772918f7e%2Flogo_pt_h.png?v=1593025666793" width="450%">
     </div>
 
</div>  
  
<div class="sidenav-bottom">  
      <a class="recorder-button" data="Grave seu relato" href="#recorderpopup1"><img src="media/rec_azul.png" width="100%"></a>    
    <div class="text-right">
      <b> Grave seu Relato</b>  
   </div>
   <div class="lang-mobile">
      PT 	&nbsp;&nbsp;<a href="http://cartografiadasmemorias.xyz/en" style="font-weight:normal;text-decoration: none;color: #23446c !important;">EN</a>    
    </div>
 
</div>    
  
      <div class="loadpopup" onclick="myFunction()">
        <span class="loadpopuptext" id="myPopup"><p style="text-align:right; margin:0px;">x</p><img style="width:55px;" src="media/gota_alta.png"><br><br>GRAVE AQUI<br>o seu relato,<br> ele é importante<br>para a construção <br>da nossa memória.</span>
      </div>

 
<div id="recorderpopup1" class="recorderoverlay">
	<div class="recorderpopup">     
    <a class="recorderclose" id="closeButton" href="#" onclick="fechar()">&times;</a>
    <div class="recordercontent" id="recordermsg">
      <p id="mensagem"></p><!--O Js preenche esse campo com a mensagem de retorno da operacao de gravacao-->
    </div>
    <div class="recordercontent" id="recorderinitinstructions">
      <br>
      <p>O áudio de seu relato terá no máximo 5 minutos de duração.</p>
      <p>Não é necessário se identificar.</p>
      <p>Para adicionarmos seu relato ao mapa sonoro informe sua localidade: cidade e bairro, ou permita que o seu dispositivo acesse sua localização.</p>
      <p>Ao enviar o áudio você concorda com os termos e autoriza o uso não-comercial de seu relato.</p>
      <br><br>
      <button class="center-button" onclick="step(1)">Próximo &gt;</button>
    </div>
		<div class="recordercontent" id="recorderinstructions" hidden>
      <br><p class="center-text" id="msgstart">Clique para GRAVAR</p>
      <br><p class="center-text" id="msgstop" hidden>Clique para finalizar</p>
       <div id="controls" class="center-text">
         <button class="transparent-button"  id="recordButton"><img src="media/gravar.png" class="center center-text" style="width:100%"></button>
         <button class="transparent-button" id="stopButton" hidden><img src="media/parar.png"  class="center center-text" style="width:73%"></button>
      </div>
      <h2  class="center-text" id="counter">00:00</h2>
      <p  class="center-text" id="msgmax">(máx. 5 minutos)</p>
    </div>
    <div class="recordercontent" id="recorderlocation" hidden>
     <br>
     <div>
         <p>Informe sua localização</p>
         <br><br>
         <label>Cidade:</label><br>
         <input style="width: 70%; background-color:transparent!important;border:0px;border-bottom: 1px solid #d9b0af" id="cidade" type="text"></input><br>
         <br><br>
         <label>Bairro:</label><br>
         <input style="width: 70%; background-color:transparent!important;border:0px;border-bottom: 1px solid #d9b0af" id="bairro" type="text"></input><br><br>
         <br><br><br><br>
         <button class="center-button" onclick="step(2)">Próximo > </button>
    </div>
    </div>
    <div class="recordercontent" id="permissaomicrofone" hidden>
      <p id="microfonenegado">Altere a permissão de seu microfone para permitir que nosso gravador possa acessá-lo. Recarregue a página e tente novamente.</p>
    </div>
    <ul style="list-style: none;" id="recordingsList"></ul>
    <!-- inserting these scripts at the end to be able to use all the elements in the DOM -->
  	<script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
    <script src="app.js"></script>
	</div>
  
</div>
  
  

  
  <script>
    var geocoder = new MapboxGeocoder({
       accessToken: mapboxgl.accessToken,
       mapboxgl: mapboxgl
    });
    
    var transformRequest = (url, resourceType) => {
      var isMapboxRequest =
        url.slice(8, 22) === "api.mapbox.com" ||
        url.slice(10, 26) === "tiles.mapbox.com";
      return {
        url: isMapboxRequest
          ? url.replace("?", "?pluginName=sheetMapper&")
          : url
      };
    };
    //YOUR TURN: add your Mapbox token 
    mapboxgl.accessToken = 'pk.eyJ1IjoiY2FydG9ncmFmaWFkYXNtZW1vcmlhcyIsImEiOiJjazlxMDN1aG0wZnY4M2xvZHJjajdldnE3In0.qHPWWLN-r8EmzjGLm3afAA'; //Mapbox token 
    var map = new mapboxgl.Map({
      container: 'map', // container id
      style: 'mapbox://styles/cartografiadasmemorias/ckaoohfqc2lt61iom1u8d9ec3', //stylesheet location
      center: [5.632976, 25.693782], // starting position
      zoom: 0.9,// starting zoom
      transformRequest: transformRequest
    });

    $(document).ready(function () {
      $.ajax({
        type: "GET",
        //YOUR TURN: Replace with csv export link
        url: 'https://docs.google.com/spreadsheets/d/13xv9K7am3ptr-Z9a734OrWoIcyWsZkX3tvUhX4lBOUQ/gviz/tq?tqx=out:csv&sheet=Sheet3',
        dataType: "text",
        success: function (csvData) { makeGeoJSON(csvData); }
      });



      function makeGeoJSON(csvData) {
        csv2geojson.csv2geojson(csvData, {
          latfield: 'Latitude',
          lonfield: 'Longitude',
          delimiter: ','
        }, function (err, data) {
          
          map.on('load', function () {
            
            map.loadImage(
             'media/gota_final.png',
              function(error, image) {
              if (error) throw error;
              map.addImage('ear', image);
            });

            //Add the the layer to the map 
           /* map.addLayer({
              'id': 'csvData',
              'type': 'circle',
              'source': {
                'type': 'geojson',
                'data': data
              },
              'paint': {
                'circle-color': "#981e3a"
              }
              
            }); */

            map.addLayer({
              'id': 'csvData',
              'type': 'symbol',
              'source': {
                'type': 'geojson',
                'data': data
              },
              'layout': {
                'icon-image': 'ear',
                'icon-anchor': 'bottom', // point of the icon which will correspond to marker's location
                "icon-allow-overlap": true,
                //'icon-size': 0.025
              }
             });


            // When a click event occurs on a feature in the csvData layer, open a popup at the
            // location of the feature, with description HTML from its properties.
            map.on('click', 'csvData', function (e) {
              var coordinates = e.features[0].geometry.coordinates.slice();

              //set popup text 
              //You can adjust the values of the popup to match the headers of your CSV. 
              // For example: e.features[0].properties.Name is retrieving information from the field Name in the original CSV. 
              /* player mixcloud
              var description = `<iframe width="100%" height="60" src="` + e.features[0].properties.Audio + `" frameborder="0" allow="autoplay"></iframe>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + ` TAGS` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              */
              
              /*
              player archive.org 
              var description = `<iframe src="` + e.features[0].properties.Audio + `" width="100%" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + `TAGS ` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              */
              
               /*
              player html*/
              var description = `<audio controls style="width:100%;" controlsList="nodownload" autoplay><source src="` + e.features[0].properties.Audio + `" type="audio/mpeg"></audio>` + `<h4>` + e.features[0].properties.Data + `</h4>` + `<h4>` + `<b>` + ` ` + `</b>` + `<br>` + e.features[0].properties.Tags + `</h4>`;
              
              
              
              // Ensure that if the map is zoomed out such that multiple
              // copies of the feature are visible, the popup appears
              // over the copy being pointed to.
              while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
              }

              //add Popup to map

              new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(description)
                .addTo(map);
            });

            // Change the cursor to a pointer when the mouse is over the places layer.
            map.on('mouseenter', 'csvData', function () {
              map.getCanvas().style.cursor = 'pointer';
            });
            
             map.on('mouseenter', 'csvData2', function () {
              map.getCanvas().style.cursor = 'pointer';
            });

            // Change it back to a pointer when it leaves.
            map.on('mouseleave', 'places', function () {
              map.getCanvas().style.cursor = '';
            });

            var bbox = turf.bbox(data);
            map.fitBounds(bbox, { padding: 50 });
 
            
            /*map.setPaintProperty('csvData', 'circle-radius', 
            ['interpolate', ['linear'], ['zoom'],
              5,
              5,
              20,
              25,
              24,
              30
            ]);*/
            
            map.setLayoutProperty('csvData', 'icon-size', 
            ['interpolate', ['linear'], ['zoom'],
              0,
              //TAMANHO AO ZOOM 0
              0.5,
              6,
              //TAMANHO AO ZOOM 7
              0.7,
              15,
              0.8,
              24,
              //TAMANHO AO ZOOM 24
              1
            ]);
        
            
          });

        });
      };
      
      
    });
    

      map.addControl(new mapboxgl.NavigationControl(), 'top-left');
      map.addControl(geocoder);
      document.getElementById('geocoder').appendChild(geocoder.onAdd(map));
      document.getElementById('zoom').addEventListener('click', function() {
        map.zoomTo(19, { duration: 9000 });
      });


        function render(feature){
            return `<span class='geocoder-menu-item'>${feature.place_name}</span>`
        }
      
    
  </script>

  
<script>
function w3_open() {
  document.getElementById("mySidebar").style.display = "block";
}

function w3_close() {
  document.getElementById("mySidebar").style.display = "none";
}
  
function myFunction() {
  var popup = document.getElementById("myPopup");
  popup.classList.toggle("show");
}
</script>

<script>
$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip();
});
</script>

<script>
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
</script>
  
</body>

</html>